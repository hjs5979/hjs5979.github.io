---
layout: single
title:  분산분석
categories: 분산분석/다중비교
tag: [Statistic, Test]
use_math: true
toc: true
author_profile: true
sidebar:
  nav: docs
---

# 일원 배치 분석

일원배치분산분석은 3개 이상의 집단의 평균이 모두 같다는 귀무가설을 세우고 분산비(F값)를 검정통계량으로 하여 F분포로 검정하는 방법입니다. 각 집단의 데이터는 등분산을 가정합니다.

독립변수가 1개이고 범주형(분류형) 변수이며 종속변수가 1개이고 수치형 변수일 때 사용합니다. 독립변수의 범주가 2개 이상이어야 합니다.

정규성, 독립성, 등분산성을 가정합니다.

검정통계량 계산을 위해 k는 집단 개수, n은 표본 전체 크기, 그룹간 편차$S_{B}$, 그룹내 편차$S_{W}$라 가정할때,

$F = \frac{\frac{S_{B}}{k-1}}{\frac{S_{W}}{n-k}}$는 F(k-1,n-k)를 따릅니다.

$H_{0} : 각 집단간에 차이가 없다.$
$H_{0} : 적어도 한쌍의 집단간에는 차이가 있다.$

ex)
한 유저 A가 유명 레이싱 게임에서 이제까지의 자신의 레이싱 데이터를 분석하려고 합니다. 이 레이싱 게임에서 유저는 레이싱을 할 때마다 자동차를 하나씩 선택하고, 게임은 도착점에 도달했을 때 자동으로 도착까지 걸린 시간에 대한 기록을 남긴다고 합니다. 이 때, 자동차에 따라 기록의 평균에 차이가 생기는 지 검정해보겠습니다.

```python
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm

model = ols('기록 ~ C(자동차)', df).fit()
anova_lm(model)
```

- 분석결과

|-|df|sum_sq|mean_sq|F|PR(&gt;F\)|
|---|---|---|---|---|---|
|C(자동차)|2.0|2138.98|1069.49|0.30|0.74|
|Residual|45.0|159047.42|3534.38|NaN|NaN|

자동차에 대한 p값이 0.05 이상이므로 귀무가설 수용합니다. 자동차에 따른 집단간 평균에 차이는 없습니다.


## 결과해석

- df : 자유도

- sum_sq
  - 처리제곱합 : 집단 간의 차이에 의한 변동
  - 잔차제곱합 : 집단 내 표본들의 변동

- mean_sq
 - 제곱합들을 각각의 자유도로 나눠준 것


- 표 해석

|요인|자유도(df)|제곱합(SS)|평균제곱(MS)|분산비(F)|
|----|----------|----------|------------|---------|
|처리|k-1|SSA|MSA = SSA/k-1|F = MSA/MSE|
|오차|N-k|SSE|MSE = SSE/N-K|||	
|전체|N-1|SST(SSA+SSE)||||		

# 이원 배치 분석

일원분산분석과 달리 독립변수가 2개 이상인 경우에 사용하는 분석 방법입니다.

수치형인 종속변인 1개이고, 범주형인 독립변인 2개 이상(범주 2개이상)일 때 사용할 수 있습니다.

일원분산분석과 가정은 같습니다.

검정통계량 계산을 위해 k는 집단 개수, n은 표본 전체 크기, 그룹간 편차$S_{B}$, 그룹내 편차$S_{W}$라 가정할때,

$F = \frac{\frac{S_{A}}{k-1}}{\frac{S_{E}}{(k-1)(l-1)}}$는 F(k-1,(k-1)(l-1))를 
따릅니다.

ex)
한 유저 A가 유명 레이싱 게임에서 이제까지의 자신의 레이싱 데이터를 분석하려고 한다. 이 레이싱 게임에서 유저는 레이싱을 할 때마다 아이템과 자동차를 하나씩 선택하고, 게임은 도착점에 도달했을 때 자동으로 도착까지 걸린 시간에 대한 기록을 남긴다고 합니다. 이 때, 아이템과 자동차에 따라 기록의 평균에 차이가 생기는 지 검정해보겠습니다.(기록은 초단위이다.)

```python
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm

model = ols('기록 ~ C(아이템) * C(자동차)', df).fit()
anova_lm(model)
```

- 분석결과

|-|df|sum_sq|mean_sq|F|PR(>F)|
|-|-|-|-|-|-|
|C(아이템)|2.0|239.446250|119.723125|0.030469|0.970013|
|C(자동차)|2.0|2959.950|248|1479.975124|0.376652|0.688624|
|C(아이템):C(자동차)|4.0|4744.513828|1186.128457|0.301868|0.874929|
|Residual|39.0|153242.502175|3929.294928|NaN|NaN|

아이템, 자동차의 p-value가 0.05보다 크므로 아이템과 자동차에 따른 집단간 평균차이는 존재하지 않습니다.
이원분산분석의 경우, 독립변수가 2개 이상이므로 2개 이상의 변수가 상호간에 영향을 주어 나타나는 반응효과에 대해서도 검정을 해주어야 합니다. 이러한 효과를 교호작용이라고 합니다. 표에서는 C(아이템):C(자동차) 로 나타나고 있는데, 이 또한 p-value가 0.05보닥 크므로 교호작용에 따라 나타나는 차이가 없다고 판단할 수 있습니다.